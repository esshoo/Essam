<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #1a1a1a; color: white; padding: 20px; }
        #admin-content { display: none; } /* Ù…Ø®ÙÙŠ Ø­ØªÙ‰ Ù†ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ© */
        .request-card { background: #333; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; }
        .btn-accept { background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="loading-msg">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„...</div>

    <div id="admin-content">
        <h1>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø© ğŸ“¥</h1>
        <div id="requests-list">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</div>
        <button onclick="logout()" style="margin-top:20px; background:#555; color:white; border:none; padding:10px; cursor:pointer;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = { /* Ø¶Ø¹ Ù†ÙØ³ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù‡Ù†Ø§ */ };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        const ADMIN_EMAIL = "esshoo@gmail.com";

        onAuthStateChanged(auth, (user) => {
            if (user && user.email === ADMIN_EMAIL) {
                // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ Ø§Ù„Ø£Ø¯Ù…Ù† ÙØ¹Ù„Ø§Ù‹
                document.getElementById('loading-msg').style.display = 'none';
                document.getElementById('admin-content').style.display = 'block';
                loadRequests();
            } else {
                // Ù„ÙŠØ³ Ø§Ù„Ø£Ø¯Ù…Ù† Ø£Ùˆ ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ -> Ø§Ø®Ø±Ø¬ ÙÙˆØ±Ø§Ù‹ Ù„Ù…Ù†Ø¹ Ø§Ù„Ù€ Loop
                window.location.replace("index.html");
            }
        });

        function loadRequests() {
            onValue(ref(db, 'requests'), (snapshot) => {
                const list = document.getElementById('requests-list');
                list.innerHTML = '';
                snapshot.forEach((child) => {
                    const req = child.val();
                    if (req.status === 'pending') {
                        const div = document.createElement('div');
                        div.className = 'request-card';
                        div.innerHTML = `
                            <div><strong>${req.name}</strong> (${req.phone})</div>
                            <button class="btn-accept" onclick="acceptUser('${child.key}', '${req.name}')">Ù‚Ø¨ÙˆÙ„</button>
                        `;
                        list.appendChild(div);
                    }
                });
            });
        }

        window.acceptUser = (key, name) => {
            update(ref(db, `requests/${key}`), { status: 'accepted' }).then(() => {
                window.open(`video.html?room=${key}&role=admin&name=${encodeURIComponent(name)}`, '_blank');
            });
        };

        window.logout = () => {
            signOut(auth).then(() => window.location.replace("index.html"));
        };
    </script>
</body>
</html>