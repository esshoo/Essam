<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #1a1a1a; color: white; padding: 20px; }
        .request-card { background: #333; padding: 20px; border-radius: 12px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; border-right: 5px solid #0088cc; }
        .btn-accept { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        .btn-reject { background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 5px; }
    </style>
</head>
<body>
    <h1>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø© ğŸ“¥</h1>
    <div id="requests-list">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = { /* Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù‡Ù†Ø§ */ };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        onAuthStateChanged(auth, (user) => {
            if (!user || user.email !== 'esshoo@gmail.com') {
                window.location.href = "index.html";
            }
        });

        onValue(ref(db, 'requests'), (snapshot) => {
            const list = document.getElementById('requests-list');
            list.innerHTML = '';
            snapshot.forEach((child) => {
                const req = child.val();
                if (req.status === 'pending') {
                    const div = document.createElement('div');
                    div.className = 'request-card';
                    div.id = `req-${child.key}`;
                    div.innerHTML = `
                        <div>
                            <strong>${req.name}</strong><br>
                            <small>${req.phone}</small>
                        </div>
                        <div>
                            <button class="btn-accept" onclick="acceptUser('${child.key}', '${req.name}')">Ù‚Ø¨ÙˆÙ„ âœ…</button>
                            <button class="btn-reject" onclick="rejectUser('${child.key}')">Ø±ÙØ¶ âœ–</button>
                        </div>
                    `;
                    list.appendChild(div);
                }
            });
            if (list.innerHTML === '') list.innerText = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹';
        });

        window.acceptUser = function(key, name) {
            update(ref(db, `requests/${key}`), { status: 'accepted' })
            .then(() => {
                window.open(`video.html?room=${key}&role=admin&name=${encodeURIComponent(name)}`, '_blank');
            });
        }

        window.rejectUser = function(key) {
            update(ref(db, `requests/${key}`), { status: 'rejected' });
        }
    </script>
</body>
</html>